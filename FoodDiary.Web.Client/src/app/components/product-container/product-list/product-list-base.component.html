<div class="product-list" fdPageContainer>
    <fd-page-header
        class="product-list__header"
        [title]="'PRODUCT_LIST.TITLE' | translate"
        [subtitle]="'PRODUCT_LIST.SUBTITLE' | translate"
    >
        <ng-container fdPageHeaderActions>
            @if (isMobileView()) {
                <div class="product-list__mobile-toolbar">
                    <fd-ui-button class="product-list__icon-button product-list__filter-button"
                        variant="secondary"
                        fill="outline"
                        icon="filter_alt"
                        [ariaLabel]="'PRODUCT_LIST.FILTERS_BUTTON' | translate"
                        (click)="openFilters()"
                        [class.product-list__filter-button--active]="hasActiveFilters"
                    />
                    <fd-ui-button
                        class="product-list__icon-button"
                        variant="secondary"
                        fill="outline"
                        icon="search"
                        [ariaLabel]="'PRODUCT_LIST.SEARCH_LABEL' | translate"
                        (click)="toggleMobileSearch()"
                    />
                    <fd-ui-button
                        class="product-list__icon-button product-list__icon-button--primary"
                        variant="primary"
                        fill="solid"
                        icon="add"
                        [ariaLabel]="'PRODUCT_LIST.ADD_PRODUCT_BUTTON' | translate"
                        (click)="onAddProductClick()"
                    />
                </div>
            } @else {
                <div class="product-list__controls">
                    <form class="product-list__search-form" [formGroup]="searchForm">
                        <fd-ui-input class="product-list__search-input"
                            formControlName="search"
                            size="md"
                            [label]="'PRODUCT_LIST.SEARCH_LABEL' | translate"
                            [prefixIcon]="'search'"
                            [placeholder]="'PRODUCT_LIST.SEARCH_PLACEHOLDER' | translate"
                            [suffixButtonIcon]="'qr_code_scanner'"
                            [suffixButtonAriaLabel]="'PRODUCT_LIST.SCAN_BARCODE' | translate"
                            (suffixButtonClicked)="openBarcodeScanner()"
                         />
                    </form>

                    <div class="product-list__filters">
                        <fd-ui-button class="product-list__icon-button product-list__filter-button"
                            variant="secondary"
                            fill="outline"
                            icon="filter_alt"
                            [ariaLabel]="'PRODUCT_LIST.FILTERS_BUTTON' | translate"
                            (click)="openFilters()"
                            [class.product-list__filter-button--active]="hasActiveFilters"
                        />
                        <fd-ui-button
                            class="product-list__add-button"
                            variant="primary"
                            fill="solid"
                            icon="add"
                            [ariaLabel]="'PRODUCT_LIST.ADD_PRODUCT_BUTTON' | translate"
                            (click)="onAddProductClick()"
                        >
                            {{ 'PRODUCT_LIST.ADD_PRODUCT_BUTTON' | translate }}
                        </fd-ui-button>
                    </div>
                </div>
            }
        </ng-container>
        @if (isMobileView()) {
            <div fdPageHeaderExtra class="product-list__mobile-search"
                [class.product-list__mobile-search--open]="isMobileSearchVisible">
                <form class="product-list__search-form product-list__search-form--mobile" [formGroup]="searchForm">
                    <fd-ui-input class="product-list__search-input"
                        formControlName="search"
                        size="md"
                        [label]="'PRODUCT_LIST.SEARCH_LABEL' | translate"
                        [prefixIcon]="'search'"
                        [placeholder]="'PRODUCT_LIST.SEARCH_PLACEHOLDER' | translate"
                        [suffixButtonIcon]="'qr_code_scanner'"
                        [suffixButtonAriaLabel]="'PRODUCT_LIST.SCAN_BARCODE' | translate"
                        (suffixButtonClicked)="openBarcodeScanner()"
                    />
                </form>
            </div>
        }
    </fd-page-header>

    <fd-page-body>
        @if (productData.isLoading()) {
            <fd-ui-loader class="product-list__loader" />
        } @else {
            @if (hasVisibleProducts) {
                <div class="product-list__groups">
                    @if (showRecentSection) {
                        <div class="product-list__section">
                            <div class="product-list__section-header">
                                <span class="product-list__section-label">
                                    {{ 'PRODUCT_LIST.RECENT_PRODUCTS' | translate }}
                                </span>
                                <span class="product-list__section-line"></span>
                            </div>
                            <div class="product-list__section-grid">
                                @for (product of recentProducts; track product) {
                                    <fd-product-card
                                        [product]="product"
                                        [imageUrl]="resolveImage(product)"
                                        (open)="onProductClick(product)"
                                        (addToMeal)="onAddToMeal(product)"
                                    />
                                }
                            </div>
                        </div>
                    }

                    @if (allProductsSectionItems.length > 0) {
                        <div class="product-list__section">
                            <div class="product-list__section-header">
                                <span class="product-list__section-label">
                                    {{ allProductsSectionLabelKey | translate }}
                                </span>
                                <span class="product-list__section-line"></span>
                            </div>
                            <div class="product-list__section-grid">
                                @for (product of allProductsSectionItems; track product) {
                                    <fd-product-card
                                        [product]="product"
                                        [imageUrl]="resolveImage(product)"
                                        (open)="onProductClick(product)"
                                        (addToMeal)="onAddToMeal(product)"
                                    />
                                }
                            </div>
                        </div>
                    }
                </div>
            } @else {
                <div class="product-list__no-results">
                    <mat-icon class="product-list__no-results-icon">search_off</mat-icon>
                    {{ 'PRODUCT_LIST.NO_PRODUCTS_FOUND' | translate }}
                </div>
            }
        }

        @if (productData.totalPages > 1) {
            <fd-ui-pagination class="product-list__pagination"
                [length]="productData.totalItems"
                [pageSize]="pageSize"
                [pageIndex]="currentPageIndex"
                (pageIndexChange)="onPageChange($event)"
             />
        }
    </fd-page-body>
</div>

