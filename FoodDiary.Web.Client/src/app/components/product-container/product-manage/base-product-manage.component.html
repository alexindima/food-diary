<div class="product-manage">
    <div class="product-manage__header">
        <h2 class="product-manage__title">
            @if (product()) {
                {{ 'PRODUCT_MANAGE.EDIT_TITLE' | translate }}
            } @else {
                {{ 'PRODUCT_MANAGE.ADD_TITLE' | translate }}
            }
        </h2>
        @if (canShowDeleteButton) {
            <fd-ui-button
                type="button"
                class="product-manage__delete-button"
                variant="danger"
                icon="delete"
                [disabled]="isDeleting()"
                (click)="onDeleteProduct()"
            >
                {{ 'PRODUCT_MANAGE.DELETE_BUTTON' | translate }}
            </fd-ui-button>
        }
    </div>

    <form class="product-manage__form" [formGroup]="productForm" (ngSubmit)="onSubmit()">
        <div class="product-manage__grid">
            <div class="product-manage__column product-manage__column--primary">
                <fd-ui-card class="product-manage__card" [title]="'PRODUCT_MANAGE.BASIC_INFO' | translate">
                    <div class="product-manage__basic-grid">
                        <div class="product-manage__field product-manage__field--full">
                            <fd-ui-input formControlName="name"
                                [label]="('PRODUCT_MANAGE.NAME' | translate) + '*'"
                                [placeholder]="'PRODUCT_MANAGE.NAME_PLACEHOLDER' | translate"
                                [required]="true"
                                [error]="getControlError('name')"
                             />
                        </div>
                        <div class="product-manage__field">
                            <fd-ui-input formControlName="barcode"
                                [label]="'PRODUCT_MANAGE.BARCODE' | translate"
                                [placeholder]="'PRODUCT_MANAGE.BARCODE_PLACEHOLDER' | translate"
                                [suffixButtonIcon]="'qr_code_scanner'"
                                [suffixButtonAriaLabel]="'PRODUCT_MANAGE.SCAN_BARCODE' | translate"
                                (suffixButtonClicked)="openBarcodeScanner()"
                             />
                        </div>
                        <div class="product-manage__field">
                            <fd-ui-select formControlName="productType"
                                [label]="('PRODUCT_MANAGE.PRODUCT_TYPE' | translate) + '*'"
                                [placeholder]="'PRODUCT_MANAGE.PRODUCT_TYPE_PLACEHOLDER' | translate"
                                [options]="productTypeSelectOptions"
                                [required]="true"
                                [error]="getControlError('productType')"
                             />
                        </div>
                        <div class="product-manage__serving-row product-manage__field--full">
                            <div class="product-manage__serving-part">
                                <fd-ui-input formControlName="baseAmount"
                                    type="number"
                                    [label]="('PRODUCT_MANAGE.DEFAULT_SERVING' | translate) + '*'"
                                    [placeholder]="'PRODUCT_MANAGE.DEFAULT_SERVING_PLACEHOLDER' | translate"
                                    [required]="true"
                                    [error]="getControlError('baseAmount')"
                                 />
                            </div>
                        <div class="product-manage__serving-part">
                            <fd-ui-select formControlName="baseUnit"
                                [label]="('PRODUCT_MANAGE.DEFAULT_SERVING_UNIT' | translate) + '*'"
                                [options]="unitOptions"
                                [required]="true"
                                [error]="getControlError('baseUnit')"
                             />
                        </div>
                        </div>
                        <div class="product-manage__field product-manage__field--full">
                            <fd-ui-textarea formControlName="comment"
                                [label]="'PRODUCT_MANAGE.COMMENT' | translate"
                                [placeholder]="'PRODUCT_MANAGE.COMMENT_PLACEHOLDER' | translate"
                                [rows]="4"
                             />
                        </div>
                    </div>
                </fd-ui-card>

                <fd-ui-card class="product-manage__card" [title]="'PRODUCT_MANAGE.NUTRITION_VALUE' | translate">
                    <div class="product-manage__nutrients-row product-manage__nutrients-row--two">
                        <div class="product-manage__nutrient">
                            <fd-ui-input formControlName="caloriesPerBase"
                                type="number"
                                [label]="('PRODUCT_MANAGE.CALORIES' | translate) + ' ' + getDynamicNutrientPlaceholder + '*'"
                                placeholder="0"
                                [required]="true"
                                [error]="getControlError('caloriesPerBase')"
                             />
                        </div>
                        <div class="product-manage__nutrient">
                            <fd-ui-input formControlName="fiberPerBase"
                                type="number"
                                [label]="('PRODUCT_MANAGE.FIBER' | translate) + ' ' + getDynamicNutrientPlaceholder + '*'"
                                placeholder="0"
                                [required]="true"
                                [error]="getControlError('fiberPerBase')"
                             />
                        </div>
                    </div>
                    <div class="product-manage__nutrients-row product-manage__nutrients-row--three">
                        <div class="product-manage__nutrient">
                            <fd-ui-input formControlName="proteinsPerBase"
                                type="number"
                                [label]="('PRODUCT_MANAGE.PROTEINS' | translate) + ' ' + getDynamicNutrientPlaceholder + '*'"
                                placeholder="0"
                                [required]="true"
                                [error]="getControlError('proteinsPerBase')"
                             />
                        </div>
                        <div class="product-manage__nutrient">
                            <fd-ui-input formControlName="fatsPerBase"
                                type="number"
                                [label]="('PRODUCT_MANAGE.FATS' | translate) + ' ' + getDynamicNutrientPlaceholder + '*'"
                                placeholder="0"
                                [required]="true"
                                [error]="getControlError('fatsPerBase')"
                             />
                        </div>
                        <div class="product-manage__nutrient">
                            <fd-ui-input formControlName="carbsPerBase"
                                type="number"
                                [label]="('PRODUCT_MANAGE.CARBS' | translate) + ' ' + getDynamicNutrientPlaceholder + '*'"
                                placeholder="0"
                                [required]="true"
                                [error]="getControlError('carbsPerBase')"
                             />
                        </div>
                    </div>
                </fd-ui-card>

            </div>

            <div class="product-manage__column product-manage__column--secondary">
                <div class="product-manage__sticky-stack">
                    <fd-ui-card class="product-manage__card" [title]="'PRODUCT_MANAGE.VISIBILITY_GROUP_TITLE' | translate">
                        <fd-ui-select formControlName="visibility"
                            [label]="('PRODUCT_MANAGE.VISIBILITY' | translate) + '*'"
                            [required]="true"
                            [options]="visibilitySelectOptions"
                            [error]="getControlError('visibility')"
                         />
                    </fd-ui-card>

                    <fd-ui-card
                        class="product-manage__card"
                        [title]="'PRODUCT_MANAGE.SUMMARY_TITLE' | translate"
                    >
                        <p class="product-manage__summary-calories">
                            {{ 'PRODUCT_MANAGE.SUMMARY_CALORIES_LABEL' | translate }}:
                            <strong>{{ calories() | number:'1.0-0' }} {{ 'STATISTICS.KKAL' | translate }}</strong>
                        </p>
                        <fd-nutrients-summary [bare]="true"
                            [calories]="calories()"
                            [nutrientChartData]="nutrientChartData()"
                            [config]="nutrientSummaryConfig"
                            [fiberValue]="productForm.controls.fiberPerBase.value ?? 0"
                            [fiberUnitKey]="
                                productForm.controls.baseUnit.value
                                    ? 'PRODUCT_AMOUNT_UNITS_SHORT.' + productForm.controls.baseUnit.value
                                    : 'PRODUCT_AMOUNT_UNITS_SHORT.G'
                            "
                         />
                    </fd-ui-card>
                </div>
            </div>
        </div>

        <div class="product-manage__footer">
            <div class="product-manage__footer-actions">
                <fd-ui-button
                    type="button"
                    fill="outline"
                    variant="primary"
                    icon="arrow_back"
                    (click)="onCancel()"
                >
                    {{ 'PRODUCT_MANAGE.CANCEL_BUTTON' | translate }}
                </fd-ui-button>
                @if (product()) {
                    <fd-ui-button
                        type="submit"
                        class="product-manage__action-button"
                        icon="save"
                    >
                        {{ 'PRODUCT_MANAGE.SAVE_BUTTON' | translate }}
                    </fd-ui-button>
                } @else {
                    <fd-ui-button
                        type="submit"
                        class="product-manage__action-button"
                        icon="add"
                    >
                        {{ 'PRODUCT_MANAGE.ADD_BUTTON' | translate }}
                    </fd-ui-button>
                }
            </div>
            <fd-ui-form-error class="product-manage__footer-error" [error]="globalError()" />
        </div>
    </form>
</div>




