<div class="recipe-select" #container>
    <h2 class="recipe-select__title">{{ 'RECIPE_SELECT_DIALOG.TITLE' | translate }}</h2>

    <div class="recipe-select__actions">
        <form class="recipe-select__search-form" [formGroup]="searchForm">
            <fd-ui-input formControlName="search"
                prefixIcon="search"
                [clearable]="true"
                [placeholder]="'RECIPE_SELECT_DIALOG.SEARCH_PLACEHOLDER' | translate"
                (cleared)="searchForm.controls.search.setValue('')"
                floatLabel="always"
             />
        </form>
        <label class="recipe-select__toggle">
            <input
                type="checkbox"
                class="recipe-select__toggle-input"
                [formControl]="searchForm.controls.onlyMine"
            />
            <span class="recipe-select__toggle-label">
                {{ 'RECIPE_SELECT_DIALOG.ONLY_MY_RECIPES' | translate }}
            </span>
        </label>
        <fd-ui-button
            icon="add"
            size="md"
            variant="primary"
            (click)="onCreateRecipeClick()"
        >
            {{ 'RECIPE_SELECT_DIALOG.ADD_RECIPE_BUTTON' | translate }}
        </fd-ui-button>
    </div>

    @if (recipeData.isLoading()) {
        <fd-ui-loader class="recipe-select__loader" />
    } @else {
        @if (recipeData.items().length > 0) {
            <div class="recipe-select__list">
                @for (recipe of recipeData.items(); track recipe.id) {
                    <fd-ui-entity-card
                        class="recipe-select__card fd-ui-entity-card--hoverable"
                        (click)="onRecipeClick(recipe)"
                        appearance="recipe"
                        [title]="recipe.name"
                        [meta]="recipe.category || undefined"
                        [imageUrl]="recipe.imageUrl"
                    >
                        <ng-container fdUiEntityCardHeader>
                            <div class="recipe-card__badges">
                                <fd-badge [label]="('RECIPE_VISIBILITY.' + recipe.visibility) | translate"
                                    [variant]="isPrivateVisibility(recipe.visibility) ? 'warning' : 'success'"
                                    [icon]="isPrivateVisibility(recipe.visibility) ? 'lock' : 'public'"
                                 />
                                <fd-badge [label]="recipe.isOwnedByCurrentUser ? ('RECIPE_SELECT_DIALOG.MY_RECIPE_BADGE' | translate) : ('RECIPE_SELECT_DIALOG.SHARED_RECIPE_BADGE' | translate)"
                                    [variant]="recipe.isOwnedByCurrentUser ? 'primary' : 'neutral'"
                                    [icon]="recipe.isOwnedByCurrentUser ? 'restaurant' : 'groups'"
                                 />
                            </div>
                        </ng-container>
                        <div class="recipe-card">
                            <div class="recipe-card__info">
                                <span>
                                    {{ 'RECIPE_SELECT_DIALOG.SERVINGS' | translate }}:
                                    {{ recipe.servings }}
                                </span>
                                <span>
                                    {{ 'RECIPE_SELECT_DIALOG.TOTAL_CALORIES' | translate }}:
                                    {{ (recipe.totalCalories ?? 0) | number:'1.0-2' }}
                                    {{ 'SHARED.NUTRIENTS_SUMMARY.KKAL' | translate }}
                                </span>
                            </div>
                            <div class="recipe-card__macros">
                                {{ 'NUTRIENTS.PROTEINS' | translate }}:
                                {{ (recipe.totalProteins ?? 0) | number:'1.0-2' }} {{ 'PRODUCT_AMOUNT_UNITS_SHORT.G' | translate }} |
                                {{ 'NUTRIENTS.FATS' | translate }}:
                                {{ (recipe.totalFats ?? 0) | number:'1.0-2' }} {{ 'PRODUCT_AMOUNT_UNITS_SHORT.G' | translate }} |
                                {{ 'NUTRIENTS.CARBS' | translate }}:
                                {{ (recipe.totalCarbs ?? 0) | number:'1.0-2' }} {{ 'PRODUCT_AMOUNT_UNITS_SHORT.G' | translate }}
                            </div>
                        </div>
                    </fd-ui-entity-card>
                }
            </div>
        } @else {
            <div class="recipe-select__no-results">
                <mat-icon class="recipe-select__no-results-icon">search_off</mat-icon>
                {{ 'RECIPE_SELECT_DIALOG.NO_RECIPES_FOUND' | translate }}
            </div>
        }
    }

    @if (recipeData.totalPages > 1) {
        <fd-ui-pagination class="recipe-select__pagination"
            [length]="recipeData.totalItems"
            [pageSize]="10"
            [pageIndex]="currentPageIndex"
            (pageIndexChange)="onPageChange($event)"
         />
    }
</div>
