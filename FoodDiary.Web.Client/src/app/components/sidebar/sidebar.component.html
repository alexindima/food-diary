<aside class="sidebar">
    <div class="sidebar__brand">
        <div class="sidebar__logo">
            <img src="assets/images/header/logo.svg" alt="Food Diary" />
        </div>
        <div class="sidebar__brand-text">
            <span class="sidebar__brand-title">Food Diary</span>
            <span class="sidebar__brand-plan">{{ 'SIDEBAR.PLAN_PRO' | translate }}</span>
        </div>
    </div>

    <nav class="sidebar__nav">
        <a routerLink="/" routerLinkActive="is-active" [routerLinkActiveOptions]="{ exact: true }" class="sidebar__link">
            <mat-icon>dashboard</mat-icon>
            <span>{{ 'SIDEBAR.DASHBOARD' | translate }}</span>
        </a>
    </nav>

    <div class="sidebar__section">
        <button class="sidebar__section-header" type="button" (click)="toggleFoodTracking()">
            <span>{{ 'SIDEBAR.FOOD_TRACKING' | translate }}</span>
            <mat-icon [class.is-open]="isFoodTrackingOpen()">expand_more</mat-icon>
        </button>
        @if (isFoodTrackingOpen()) {
            <nav class="sidebar__nav sidebar__nav--secondary">
                <a routerLink="/meals" routerLinkActive="is-active" class="sidebar__link sidebar__link--secondary">
                    <mat-icon>restaurant_menu</mat-icon>
                    <span>{{ 'SIDEBAR.FOOD_DIARY' | translate }}</span>
                </a>
                <a routerLink="/products" routerLinkActive="is-active" class="sidebar__link sidebar__link--secondary">
                    <mat-icon>inventory_2</mat-icon>
                    <span>{{ 'SIDEBAR.PRODUCTS' | translate }}</span>
                </a>
                <a routerLink="/recipes" routerLinkActive="is-active" class="sidebar__link sidebar__link--secondary">
                    <mat-icon>restaurant</mat-icon>
                    <span>{{ 'SIDEBAR.RECIPES' | translate }}</span>
                </a>
                <a routerLink="/shopping-lists" routerLinkActive="is-active" class="sidebar__link sidebar__link--secondary">
                    <mat-icon>shopping_cart</mat-icon>
                    <span>{{ 'SIDEBAR.SHOPPING_LIST' | translate }}</span>
                </a>
            </nav>
        }
    </div>

    <div class="sidebar__section">
        <button class="sidebar__section-header" type="button" (click)="toggleBodyTracking()">
            <span>{{ 'SIDEBAR.BODY_TRACKING' | translate }}</span>
            <mat-icon [class.is-open]="isBodyTrackingOpen()">expand_more</mat-icon>
        </button>
        @if (isBodyTrackingOpen()) {
            <nav class="sidebar__nav sidebar__nav--secondary">
                <a routerLink="/weight-history" routerLinkActive="is-active" class="sidebar__link sidebar__link--secondary">
                    <mat-icon>monitor_weight</mat-icon>
                    <span>{{ 'SIDEBAR.WEIGHT' | translate }}</span>
                </a>
                <a routerLink="/waist-history" routerLinkActive="is-active" class="sidebar__link sidebar__link--secondary">
                    <mat-icon>straighten</mat-icon>
                    <span>{{ 'SIDEBAR.WAIST' | translate }}</span>
                </a>
                <a routerLink="/cycle-tracking" routerLinkActive="is-active" class="sidebar__link sidebar__link--secondary">
                    <mat-icon>favorite</mat-icon>
                    <span>{{ 'SIDEBAR.CYCLE' | translate }}</span>
                </a>
            </nav>
        }
    </div>

    <div class="sidebar__spacer"></div>

    <nav class="sidebar__nav sidebar__nav--secondary sidebar__nav--bottom">
        <a routerLink="/statistics" routerLinkActive="is-active" class="sidebar__link sidebar__link--secondary">
            <mat-icon>bar_chart</mat-icon>
            <span>{{ 'SIDEBAR.REPORTS' | translate }}</span>
        </a>
        <a routerLink="/goals" routerLinkActive="is-active" class="sidebar__link sidebar__link--secondary">
            <mat-icon>flag</mat-icon>
            <span>{{ 'SIDEBAR.GOALS' | translate }}</span>
        </a>
    </nav>

    @if (currentUser(); as user) {
        <div class="sidebar__user-wrapper">
            <button type="button" class="sidebar__user" (click)="toggleUserMenu()">
                @if (user.profileImage) {
                    <div class="sidebar__avatar sidebar__avatar--image">
                        <img [src]="user.profileImage" alt="Avatar" />
                    </div>
                } @else {
                    <div class="sidebar__avatar">
                        {{ (user.username || user.email || 'U') | slice:0:1 | uppercase }}
                    </div>
                }
                <div class="sidebar__user-meta">
                    <div class="sidebar__user-name">{{ user.username || user.email }}</div>
                    <div class="sidebar__user-plan">
                        {{ (isPremium() ? 'SIDEBAR.PLAN_PRO' : 'SIDEBAR.PLAN_FREE') | translate }}
                    </div>
                </div>
                <mat-icon class="sidebar__user-arrow" [class.is-open]="isUserMenuOpen()">expand_less</mat-icon>
            </button>

            @if (isUserMenuOpen()) {
                <div class="sidebar__user-menu">
                    <a routerLink="/profile" routerLinkActive="is-active" class="sidebar__user-menu-link">
                        <mat-icon>settings</mat-icon>
                        <span>{{ 'HEADER.ACCOUNT' | translate }}</span>
                    </a>
                    <button type="button" class="sidebar__logout" (click)="logout()">
                        <mat-icon>logout</mat-icon>
                        <span>{{ 'HEADER.LOGOUT' | translate }}</span>
                    </button>
                </div>
            }
        </div>
    }
</aside>

<nav class="sidebar-mobile" aria-label="Mobile navigation">
    @if (isAuthenticated()) {
        <section class="sidebar-mobile__progress" aria-live="polite">
            <div class="sidebar-mobile__progress-head">
                <span class="sidebar-mobile__progress-title">{{ 'SIDEBAR.DAILY_NORM' | translate }}</span>
                <span class="sidebar-mobile__progress-value">
                    {{ Math.round(dailyConsumedKcal()) }}/{{ Math.round(dailyGoalKcal()) }} {{ 'GENERAL.UNITS.KCAL' | translate }}
                </span>
            </div>
            <div class="sidebar-mobile__progress-track" aria-hidden="true">
                <span class="sidebar-mobile__progress-fill" [style.width.%]="dailyProgressPercent()"></span>
            </div>
        </section>
    }

    <div class="sidebar-mobile__nav">
        <a
            class="sidebar-mobile__item"
            routerLink="/"
            routerLinkActive="is-active"
            [routerLinkActiveOptions]="{ exact: true }"
            (click)="closeMobileMenus()"
        >
            <mat-icon>dashboard</mat-icon>
            <span class="sidebar-mobile__label">{{ 'SIDEBAR.DASHBOARD' | translate }}</span>
        </a>
        <button
            type="button"
            class="sidebar-mobile__item"
            [class.is-open]="isMobileFoodOpen()"
            (click)="toggleMobileFood()"
            aria-haspopup="true"
            [attr.aria-expanded]="isMobileFoodOpen()"
        >
            <mat-icon>restaurant_menu</mat-icon>
            <span class="sidebar-mobile__label">{{ 'SIDEBAR.FOOD' | translate }}</span>
        </button>
        <button
            type="button"
            class="sidebar-mobile__item"
            [class.is-open]="isMobileBodyOpen()"
            (click)="toggleMobileBody()"
            aria-haspopup="true"
            [attr.aria-expanded]="isMobileBodyOpen()"
        >
            <mat-icon>monitor_weight</mat-icon>
            <span class="sidebar-mobile__label">{{ 'SIDEBAR.BODY' | translate }}</span>
        </button>
        <button
            type="button"
            class="sidebar-mobile__item"
            [class.is-open]="isMobileReportsOpen()"
            (click)="toggleMobileReports()"
            aria-haspopup="true"
            [attr.aria-expanded]="isMobileReportsOpen()"
        >
            <mat-icon>bar_chart</mat-icon>
            <span class="sidebar-mobile__label">{{ 'SIDEBAR.REPORTS' | translate }}</span>
        </button>
        <button
            type="button"
            class="sidebar-mobile__item"
            [class.is-open]="isMobileUserOpen()"
            (click)="toggleMobileUser()"
            aria-haspopup="true"
            [attr.aria-expanded]="isMobileUserOpen()"
        >
            <mat-icon>person</mat-icon>
            <span class="sidebar-mobile__label">{{ 'SIDEBAR.USER' | translate }}</span>
        </button>
    </div>
</nav>

@if (isMobileFoodOpen()) {
    <div class="sidebar-mobile__sheet" role="dialog" [attr.aria-label]="'SIDEBAR.FOOD_TRACKING' | translate">
        <a routerLink="/meals" routerLinkActive="is-active" (click)="closeMobileMenus()">
            <mat-icon>restaurant_menu</mat-icon>
            <span>{{ 'SIDEBAR.FOOD_DIARY' | translate }}</span>
        </a>
        <a routerLink="/products" routerLinkActive="is-active" (click)="closeMobileMenus()">
            <mat-icon>inventory_2</mat-icon>
            <span>{{ 'SIDEBAR.PRODUCTS' | translate }}</span>
        </a>
        <a routerLink="/recipes" routerLinkActive="is-active" (click)="closeMobileMenus()">
            <mat-icon>restaurant</mat-icon>
            <span>{{ 'SIDEBAR.RECIPES' | translate }}</span>
        </a>
        <a routerLink="/shopping-lists" routerLinkActive="is-active" (click)="closeMobileMenus()">
            <mat-icon>shopping_cart</mat-icon>
            <span>{{ 'SIDEBAR.SHOPPING_LIST' | translate }}</span>
        </a>
    </div>
}

@if (isMobileBodyOpen()) {
    <div class="sidebar-mobile__sheet" role="dialog" [attr.aria-label]="'SIDEBAR.BODY_TRACKING' | translate">
        <a routerLink="/weight-history" routerLinkActive="is-active" (click)="closeMobileMenus()">
            <mat-icon>monitor_weight</mat-icon>
            <span>{{ 'SIDEBAR.WEIGHT' | translate }}</span>
        </a>
        <a routerLink="/waist-history" routerLinkActive="is-active" (click)="closeMobileMenus()">
            <mat-icon>straighten</mat-icon>
            <span>{{ 'SIDEBAR.WAIST' | translate }}</span>
        </a>
        <a routerLink="/cycle-tracking" routerLinkActive="is-active" (click)="closeMobileMenus()">
            <mat-icon>favorite</mat-icon>
            <span>{{ 'SIDEBAR.CYCLE' | translate }}</span>
        </a>
    </div>
}

@if (isMobileReportsOpen()) {
    <div class="sidebar-mobile__sheet" role="dialog" [attr.aria-label]="'SIDEBAR.REPORTS_AND_GOALS' | translate">
        <a routerLink="/statistics" routerLinkActive="is-active" (click)="closeMobileMenus()">
            <mat-icon>bar_chart</mat-icon>
            <span>{{ 'SIDEBAR.REPORTS' | translate }}</span>
        </a>
        <a routerLink="/goals" routerLinkActive="is-active" (click)="closeMobileMenus()">
            <mat-icon>flag</mat-icon>
            <span>{{ 'SIDEBAR.GOALS' | translate }}</span>
        </a>
    </div>
}

@if (isMobileUserOpen()) {
    <div class="sidebar-mobile__sheet" role="dialog" [attr.aria-label]="'SIDEBAR.USER_MENU' | translate">
        <a routerLink="/profile" routerLinkActive="is-active" (click)="closeMobileMenus()">
            <mat-icon>settings</mat-icon>
            <span>{{ 'HEADER.ACCOUNT' | translate }}</span>
        </a>
        <button type="button" (click)="logout(); closeMobileMenus()">
            <mat-icon>logout</mat-icon>
            <span>{{ 'HEADER.LOGOUT' | translate }}</span>
        </button>
    </div>
}
