<div class="consumption-ring-card">
    <div class="consumption-ring-card__layout">
        <div
            class="consumption-ring-card__chart"
            [class.is-daily-hovered]="isDailyHovered()"
            [class.is-weekly-hovered]="isWeeklyHovered()"
        >
            <svg
                class="consumption-ring-card__svg"
                viewBox="-5 -5 270 270"
                aria-hidden="true"
            >
                <defs>
                    <linearGradient
                        [id]="dailyGradientId"
                        x1="0%"
                        y1="0%"
                        x2="100%"
                        y2="100%"
                    >
                        <stop offset="0%" [attr.stop-color]="dailyGradientStart()" />
                        <stop offset="100%" [attr.stop-color]="dailyGradientEnd()" />
                    </linearGradient>
                    <linearGradient
                        [id]="weeklyGradientId"
                        x1="0%"
                        y1="0%"
                        x2="100%"
                        y2="100%"
                    >
                        <stop offset="0%" [attr.stop-color]="weeklyGradientStart()" />
                        <stop offset="100%" [attr.stop-color]="weeklyGradientEnd()" />
                    </linearGradient>
                </defs>
                <g
                    class="consumption-ring-card__ring consumption-ring-card__ring--daily"
                    [class.is-hovered]="isDailyHovered()"
                    (mouseenter)="setDailyHover(true)"
                    (mouseleave)="setDailyHover(false)"
                    [attr.tabindex]="0"
                    (focus)="setDailyHover(true)"
                    (blur)="setDailyHover(false)"
                    [style.--ring-color]="dailyStrokeColor()"
                >
                    <circle
                        class="consumption-ring-card__track consumption-ring-card__track--daily"
                        [class.is-hovered]="isDailyHovered()"
                        cx="130"
                        cy="130"
                        r="112"
                    />
                    <circle
                        class="consumption-ring-card__progress consumption-ring-card__progress--daily"
                        [class.is-hovered]="isDailyHovered()"
                        cx="130"
                        cy="130"
                        r="112"
                        [attr.stroke-dasharray]="dailyDasharray()"
                        [attr.stroke]="'url(#' + dailyGradientId + ')'"
                    />
                </g>

                <g
                    class="consumption-ring-card__ring consumption-ring-card__ring--weekly"
                    [class.is-hovered]="isWeeklyHovered()"
                    (mouseenter)="setWeeklyHover(true)"
                    (mouseleave)="setWeeklyHover(false)"
                    [attr.tabindex]="0"
                    (focus)="setWeeklyHover(true)"
                    (blur)="setWeeklyHover(false)"
                    [style.--ring-color]="weeklyStrokeColor()"
                >
                    <circle
                        class="consumption-ring-card__track consumption-ring-card__track--weekly"
                        [class.is-hovered]="isWeeklyHovered()"
                        cx="130"
                        cy="130"
                        r="88"
                    />
                    <circle
                        class="consumption-ring-card__progress consumption-ring-card__progress--weekly"
                        [class.is-hovered]="isWeeklyHovered()"
                        cx="130"
                        cy="130"
                        r="88"
                        [attr.stroke-dasharray]="weeklyDasharray()"
                        [attr.stroke]="'url(#' + weeklyGradientId + ')'"
                    />
                </g>
            </svg>

            <div
                class="consumption-ring-card__center"
                [class.is-daily-hovered]="isDailyHovered()"
                [class.is-weekly-hovered]="isWeeklyHovered()"
            >
                <div class="consumption-ring-card__percent">
                    <span class="consumption-ring-card__percent-value">{{ dailyPercent() }}</span>
                    <span class="consumption-ring-card__percent-sign">%</span>
                </div>
                <div class="consumption-ring-card__primary-line">
                    {{ dailyConsumed() | number:'1.0-0' }} / {{ normalizedDailyGoal() | number:'1.0-0' }}
                    {{ 'CONSUMPTION_RING.UNIT' | translate }}
                </div>
                <div class="consumption-ring-card__secondary-line">
                    {{ 'CONSUMPTION_RING.WEEKLY_LABEL' | translate }}: {{ weeklyPercent() }}%
                </div>
            </div>
        </div>

        <div class="consumption-ring-card__bars">
            @for (bar of resolvedNutrientBars(); track bar.id) {
                <div class="consumption-ring-card__bar">
                    <div class="consumption-ring-card__bar-header">
                        <span class="consumption-ring-card__bar-label">{{ bar.label }}</span>
                        <span
                            class="consumption-ring-card__bar-value"
                            [style.color]="getBarColor(bar)"
                        >
                            {{ bar.current | number:'1.0-0' }} / {{ bar.target | number:'1.0-0' }} {{ bar.unit }}
                        </span>
                    </div>
                    <div class="consumption-ring-card__bar-track">
                        <div
                            class="consumption-ring-card__bar-fill"
                            [style.background]="
                                'linear-gradient(90deg, ' + bar.colorStart + ' 0%, ' + bar.colorEnd + ' 100%)'
                            "
                            [style.width.%]="clampPercent((bar.current / (bar.target || 1)) * 100)"
                        ></div>
                    </div>
                </div>
            }
        </div>
    </div>
</div>
