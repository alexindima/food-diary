<div class="image-upload-field" [class.image-upload-field--disabled]="disabled">
    <div
        class="image-upload-field__dropzone"
        [class.image-upload-field__dropzone--dragging]="isDragging"
        [class.image-upload-field__dropzone--uploading]="isUploading"
        [class.image-upload-field__dropzone--has-image]="!!selection.url"
        (click)="onZoneClick(fileInput)"
        (drop)="onDrop($event)"
    >
        <input
            #fileInput
            type="file"
            [accept]="acceptedTypes()"
            [disabled]="disabled || isUploading"
            (change)="onFileSelected($event)"
            hidden
        />

        @if (selection.url) {
            <img class="image-upload-field__preview" [src]="selection.url" alt="Preview" />
            <div class="image-upload-field__control">
                <button
                    type="button"
                    class="image-upload-field__control-btn"
                    [title]="'IMAGE_UPLOAD_FIELD.REPLACE' | translate"
                    (click)="$event.stopPropagation(); fileInput.click()"
                >
                    &#10227;
                </button>
                <button
                    type="button"
                    class="image-upload-field__control-btn image-upload-field__control-btn--danger"
                    [title]="'IMAGE_UPLOAD_FIELD.REMOVE' | translate"
                    (click)="onDeleteClick($event)"
                >
                    &#128465;
                </button>
            </div>
        } @else {
            <div class="image-upload-field__placeholder">
                <div class="image-upload-field__icon">â†‘</div>
                <div class="image-upload-field__main-text">{{ 'IMAGE_UPLOAD_FIELD.SELECT_FILE' | translate }}</div>
                <div class="image-upload-field__sub-text image-upload-field__sub-text--plain">
                    {{ 'IMAGE_UPLOAD_FIELD.DROP_HERE' | translate }}
                </div>
                <div class="image-upload-field__sub-text">
                    {{ description() || ( 'IMAGE_UPLOAD_FIELD.DEFAULT_DESCRIPTION' | translate:{ maxSizeMb: maxSizeMb() } ) }}
                </div>
                <div class="image-upload-field__hint">
                    {{ 'IMAGE_UPLOAD_FIELD.RECOMMENDED' | translate:{ size: recommendedSize() } }}
                </div>
            </div>
        }

        @if (isUploading) {
            <div class="image-upload-field__overlay">{{ 'IMAGE_UPLOAD_FIELD.UPLOADING' | translate }}</div>
        }
    </div>
    @if (error) {
        <span class="image-upload-field__error">{{ error }}</span>
    }

    @if (isCropping && cropPreviewUrl) {
        <div class="image-upload-field__cropper-backdrop">
            <div class="image-upload-field__cropper">
                <div class="image-upload-field__cropper-header">
                    <div class="image-upload-field__cropper-title">{{ 'IMAGE_UPLOAD_FIELD.CROP_TITLE' | translate }}</div>
                    <div class="image-upload-field__cropper-subtitle">
                        {{ 'IMAGE_UPLOAD_FIELD.CROP_SUBTITLE' | translate }}
                    </div>
                </div>
                <div class="image-upload-field__cropper-body">
                    <img
                        #cropImage
                        [src]="cropPreviewUrl"
                        alt="Crop preview"
                        (load)="onCropperImageLoaded(cropImage)"
                        class="image-upload-field__cropper-image"
                    />
                </div>
                <div class="image-upload-field__cropper-actions">
                    <fd-ui-button type="button" variant="secondary" fill="ghost" (click)="cancelCrop()">{{ 'COMMON.CANCEL' | translate }}</fd-ui-button>
                    <fd-ui-button type="button" variant="primary" icon="check" (click)="confirmCrop()">
                        {{ 'IMAGE_UPLOAD_FIELD.APPLY' | translate }}
                    </fd-ui-button>
                </div>
            </div>
        </div>
    }
</div>
