<div class="image-upload-field" [class.image-upload-field--disabled]="disabled">
    <div
        class="image-upload-field__dropzone"
        [class.image-upload-field__dropzone--dragging]="isDragging"
        [class.image-upload-field__dropzone--uploading]="isUploading"
        [class.image-upload-field__dropzone--has-image]="!!selection.url"
        (click)="onZoneClick(fileInput)"
        (drop)="onDrop($event)"
    >
        <input
            #fileInput
            type="file"
            [accept]="acceptedTypes()"
            [disabled]="disabled || isUploading"
            (change)="onFileSelected($event)"
            hidden
        />

        @if (selection.url) {
            <img class="image-upload-field__preview" [src]="selection.url" alt="Preview" />
            <div class="image-upload-field__control">
                <button
                    type="button"
                    class="image-upload-field__control-btn"
                    title="Replace"
                    (click)="$event.stopPropagation(); fileInput.click()"
                >
                    &#10227;
                </button>
                <button
                    type="button"
                    class="image-upload-field__control-btn image-upload-field__control-btn--danger"
                    title="Remove"
                    (click)="onDeleteClick($event)"
                >
                    &#128465;
                </button>
            </div>
        } @else {
            <div class="image-upload-field__placeholder">
                <div class="image-upload-field__icon">â†‘</div>
                <div class="image-upload-field__main-text">Select a file</div>
                <div class="image-upload-field__sub-text image-upload-field__sub-text--plain">or drop it here</div>
                <div class="image-upload-field__sub-text">
                    {{ description() || ('JPG, PNG, GIF, WebP up to ' + maxSizeMb() + ' MB.') }}
                </div>
                <div class="image-upload-field__hint">Recommended: {{ recommendedSize() }}.</div>
            </div>
        }

        @if (isUploading) {
            <div class="image-upload-field__overlay">Uploading...</div>
        }
    </div>
    @if (error) {
        <span class="image-upload-field__error">{{ error }}</span>
    }

    @if (isCropping && cropPreviewUrl) {
        <div class="image-upload-field__cropper-backdrop">
            <div class="image-upload-field__cropper">
                <div class="image-upload-field__cropper-header">
                    <div class="image-upload-field__cropper-title">Crop image</div>
                    <div class="image-upload-field__cropper-subtitle">
                        Keep a square crop so your avatar looks sharp.
                    </div>
                </div>
                <div class="image-upload-field__cropper-body">
                    <img
                        #cropImage
                        [src]="cropPreviewUrl"
                        alt="Crop preview"
                        (load)="onCropperImageLoaded(cropImage)"
                        class="image-upload-field__cropper-image"
                    />
                </div>
                <div class="image-upload-field__cropper-actions">
                    <fd-ui-button type="button" variant="secondary" fill="ghost" (click)="cancelCrop()">
                        Cancel
                    </fd-ui-button>
                    <fd-ui-button type="button" variant="primary" icon="check" (click)="confirmCrop()">
                        Apply
                    </fd-ui-button>
                </div>
            </div>
        </div>
    }
</div>
