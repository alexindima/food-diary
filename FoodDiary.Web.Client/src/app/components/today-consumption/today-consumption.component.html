<div class="dashboard" fdPageContainer>
    <fd-page-header
        class="dashboard__header"
        [title]="
            isTodaySelected()
                ? ('DASHBOARD.TITLE' | translate)
                : ('DASHBOARD.TITLE_FOR_DATE' | translate:{ date: (selectedDate() | localizedDate:'d MMMM y') })
        "
        [subtitle]="'DASHBOARD.SUBTITLE' | translate"
    >
        <ng-container fdPageHeaderActions>
            <div>
                <mat-form-field class="dashboard__date-field" appearance="outline">
                    <input
                        matInput
                        [matDatepicker]="headerDatePicker"
                        [value]="selectedDate()"
                        (dateChange)="handleDateChange($event)"
                    />
                </mat-form-field>
                <mat-datepicker #headerDatePicker />
                <fd-ui-button
                    class="dashboard__date-button"
                    variant="secondary"
                    fill="outline"
                    icon="calendar_today"
                    (click)="openDatePicker()"
                >
                    {{ selectedDate() | localizedDate:'d MMMM y' }}
                </fd-ui-button>
            </div>

            <fd-ui-button
                class="dashboard__primary-action"
                icon="add"
                (click)="addConsumption()"
            >
                {{ 'DASHBOARD.ACTIONS.ADD_CONSUMPTION_BUTTON' | translate }}
            </fd-ui-button>
        </ng-container>
    </fd-page-header>

    <fd-page-body>
        @if (isLoading()) {
            <div class="dashboard__loader">{{ 'DASHBOARD.LOADING' | translate }}</div>
        } @else {
            <section class="dashboard__grid">
                <div class="dashboard__column">
                    <fd-daily-progress-card
                        class="dashboard__card dashboard__card--progress"
                        [date]="selectedDate()"
                        [consumed]="todayCalories()"
                        [goal]="dailyGoal()"
                    />

                    <div class="dashboard__row dashboard__row--pair">
                        <fd-weight-summary-card
                            class="dashboard__card dashboard__card--weight dashboard__card--clickable"
                            [latest]="latestWeight()"
                            [previous]="previousWeight()"
                            [desired]="desiredWeight()"
                            (cardClick)="openWeightHistory()"
                        />
                        <fd-waist-summary-card
                            class="dashboard__card dashboard__card--waist dashboard__card--clickable"
                            [latest]="latestWaist()"
                            [previous]="previousWaist()"
                            [desired]="desiredWaist()"
                            (cardClick)="openWaistHistory()"
                        />
                    </div>
                </div>

                <div class="dashboard__column dashboard__column--aside">
                    <fd-macro-summary
                        class="dashboard__card dashboard__card--macros"
                        [nutrientData]="nutrientChartData()"
                        [fiber]="todayFiber() ?? 0"
                        [proteinGoal]="proteinGoal()"
                        [fatGoal]="fatGoal()"
                        [carbGoal]="carbGoal()"
                        [fiberGoal]="fiberGoal()"
                    />

                    <fd-activity-card
                        class="dashboard__card dashboard__card--activity"
                        [burnedCalories]="215"
                        [steps]="5420"
                    />
                </div>
            </section>

            <section class="dashboard__meals">
                <div class="dashboard__section-header">
                    <div>
                        <h2 class="dashboard__section-title">{{ 'DASHBOARD.MEALS_TITLE' | translate }}</h2>
                    </div>
                    <fd-ui-button
                        variant="primary"
                        fill="text"
                        size="sm"
                        icon="open_in_new"
                        (click)="manageConsumptions()"
                    >
                        {{ 'DASHBOARD.MEALS_VIEW_ALL' | translate }}
                    </fd-ui-button>
                </div>

                @if (meals().length === 0) {
                    <div class="dashboard__empty">
                        {{ 'DASHBOARD.MEALS_EMPTY' | translate }}
                    </div>
                } @else {
                    <div class="dashboard__meal-list">
                        @for (meal of meals(); track meal.id) {
                            <fd-meal-card
                                class="dashboard__meal-card"
                                [meal]="meal"
                                (open)="openConsumption(meal)"
                            />
                        }
                    </div>
                }
            </section>

            <fd-quick-actions-section />
        }
    </fd-page-body>
</div>
