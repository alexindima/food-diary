<div class="dashboard" fdPageContainer>
    <fd-page-header
        class="dashboard__header"
        [title]="
            isTodaySelected()
                ? ('DASHBOARD.TITLE' | translate)
                : ('DASHBOARD.TITLE_FOR_DATE' | translate:{ date: (selectedDate() | localizedDate:'d MMMM y') })
        "
        [subtitle]="'DASHBOARD.SUBTITLE' | translate"
    >
        <ng-container fdPageHeaderActions>
            <div>
                <mat-form-field class="dashboard__date-field" appearance="outline">
                    <input
                        matInput
                        [matDatepicker]="headerDatePicker"
                        [value]="selectedDate()"
                        (dateChange)="handleDateChange($event)"
                    />
                </mat-form-field>
                <mat-datepicker #headerDatePicker />
                <fd-ui-button
                    class="dashboard__date-button"
                    variant="secondary"
                    fill="outline"
                    icon="calendar_today"
                    (click)="openDatePicker()"
                >
                    {{ selectedDate() | localizedDate:'d MMMM y' }}
                </fd-ui-button>
            </div>

            <fd-ui-button
                class="dashboard__primary-action"
                icon="add"
                (click)="addConsumption()"
            >
                {{ 'DASHBOARD.ACTIONS.ADD_CONSUMPTION_BUTTON' | translate }}
            </fd-ui-button>
        </ng-container>
    </fd-page-header>

    <fd-page-body>
        @if (isLoading()) {
            <div class="dashboard__loader">{{ 'DASHBOARD.LOADING' | translate }}</div>
        } @else {
            <section class="dashboard__grid">
                <div class="dashboard__column">
                    <fd-consumption-ring-card
                        class="dashboard__card dashboard__card--ring"
                        [dailyGoal]="consumptionRingData().dailyGoal"
                        [dailyConsumed]="consumptionRingData().dailyConsumed"
                        [weeklyConsumed]="consumptionRingData().weeklyConsumed"
                        [weeklyGoal]="consumptionRingData().weeklyGoal"
                        [nutrientBars]="consumptionRingData().nutrientBars"
                    />

                    <fd-meals-preview
                        [entries]="mealPreviewEntries()"
                        [titleText]="
                            isTodaySelected()
                                ? null
                                : ('DASHBOARD.MEALS_TITLE_FOR_DATE' | translate:{ date: (selectedDate() | localizedDate:'d MMMM y') })
                        "
                        [titleKey]="'DASHBOARD.MEALS_TITLE'"
                        [viewAllKey]="'DASHBOARD.MEALS_VIEW_ALL'"
                        [emptyKey]="isTodaySelected() ? 'DASHBOARD.MEALS_EMPTY' : 'DASHBOARD.MEALS_EMPTY_FOR_DATE'"
                        [showAddButtons]="isTodaySelected()"
                        [showEmptyState]="!isTodaySelected()"
                        (viewAll)="manageConsumptions()"
                        (add)="addConsumption($event)"
                        (open)="openConsumption($event)"
                    />

                </div>

                <div class="dashboard__column dashboard__column--aside">
                    <fd-hydration-card
                        class="dashboard__card dashboard__card--hydration"
                        [total]="hydration()?.totalMl ?? 0"
                        [goal]="hydration()?.goalMl ?? 2500"
                        [isLoading]="isHydrationLoading()"
                        [canAdd]="isTodaySelected()"
                        (addClick)="addHydration($event)"
                    />
                    <fd-weight-trend-card
                        class="dashboard__card dashboard__card--weight-trend"
                        [currentWeight]="weightTrendCurrent()"
                        [change]="weightTrendChange()"
                        [points]="weightTrendSeries()"
                        [timeframeLabel]="'WEIGHT_TREND_CARD.LAST_7_DAYS' | translate"
                        [isLoading]="isWeightTrendLoading()"
                    />
                    <fd-weight-trend-card
                        class="dashboard__card dashboard__card--waist-trend"
                        [title]="'WAIST_CARD.TITLE'"
                        [currentWeight]="waistTrendCurrent()"
                        [change]="waistTrendChange()"
                        [points]="waistTrendSeries()"
                        [timeframeLabel]="'WEIGHT_TREND_CARD.LAST_7_DAYS' | translate"
                        [unitKey]="'WAIST_CARD.CM'"
                        [iconLabel]="'WS'"
                        [accentColor]="'#0ea5e9'"
                        [iconGradient]="'linear-gradient(135deg, #22c55e, #10b981)'"
                        [isLoading]="isWaistTrendLoading()"
                    />
                    <fd-daily-advice-card
                        class="dashboard__card dashboard__card--advice"
                        [advice]="dailyAdvice()"
                        [isLoading]="isAdviceLoading()"
                    />

                </div>
            </section>

        }
    </fd-page-body>
</div>
