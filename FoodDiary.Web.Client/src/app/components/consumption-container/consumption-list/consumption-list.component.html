<div class="consumption-list" fdPageContainer #container>
    <fd-page-header
        class="consumption-list__header"
        [title]="'CONSUMPTION_LIST.TITLE' | translate"
        [subtitle]="'CONSUMPTION_LIST.SUBTITLE' | translate"
    >
        <ng-container fdPageHeaderActions>
            @if (isMobileView()) {
                <div class="consumption-list__mobile-toolbar">
                    <fd-ui-button class="consumption-list__icon-button consumption-list__filter-button"
                        variant="secondary"
                        fill="outline"
                        icon="date_range"
                        [ariaLabel]="'CONSUMPTION_LIST.DATE_FILTER_BUTTON' | translate"
                        (click)="toggleMobileDateFilter()"
                        [class.consumption-list__filter-button--active]="hasDateFilter"
                    />
                    <fd-ui-button
                        class="consumption-list__icon-button consumption-list__icon-button--primary"
                        icon="add"
                        variant="primary"
                        fill="solid"
                        [ariaLabel]="'CONSUMPTION_LIST.ADD_CONSUMPTION_BUTTON' | translate"
                        (click)="goToConsumptionAdd()"
                    />
                </div>
            } @else {
                <div class="consumption-list__controls">
                    <form [formGroup]="searchForm" class="consumption-list__date-range-form">
                        <fd-ui-date-range-input formControlName="dateRange"
                            class="consumption-list__date-input"
                            [startLabel]="'CONSUMPTION_LIST.DATE_FILTER_FROM_LABEL' | translate"
                            [endLabel]="'CONSUMPTION_LIST.DATE_FILTER_TO_LABEL' | translate"
                            [startPlaceholder]="'CONSUMPTION_LIST.DATE_FROM_PLACEHOLDER' | translate"
                            [endPlaceholder]="'CONSUMPTION_LIST.DATE_TO_PLACEHOLDER' | translate"
                        />
                    </form>

                    <div class="consumption-list__actions">
                        <fd-ui-button
                            class="consumption-list__add-button"
                            icon="add"
                            variant="primary"
                            fill="solid"
                            [ariaLabel]="'CONSUMPTION_LIST.ADD_CONSUMPTION_BUTTON' | translate"
                            (click)="goToConsumptionAdd()"
                        >
                            {{ 'CONSUMPTION_LIST.ADD_CONSUMPTION_BUTTON' | translate }}
                        </fd-ui-button>
                    </div>
                </div>
            }
        </ng-container>

        @if (isMobileView()) {
            <div fdPageHeaderExtra class="consumption-list__mobile-filter"
                [class.consumption-list__mobile-filter--open]="isMobileDateFilterVisible">
                <form [formGroup]="searchForm" class="consumption-list__date-range-form consumption-list__date-range-form--mobile">
                    <fd-ui-date-range-input formControlName="dateRange"
                        class="consumption-list__date-input"
                        [startLabel]="'CONSUMPTION_LIST.DATE_FILTER_FROM_LABEL' | translate"
                        [endLabel]="'CONSUMPTION_LIST.DATE_FILTER_TO_LABEL' | translate"
                        [startPlaceholder]="'CONSUMPTION_LIST.DATE_FROM_PLACEHOLDER' | translate"
                        [endPlaceholder]="'CONSUMPTION_LIST.DATE_TO_PLACEHOLDER' | translate"
                    />
                </form>
            </div>
        }
    </fd-page-header>

    <fd-page-body>
        @if (consumptionData.isLoading()) {
            <fd-ui-loader class="consumption-list__loader" />
        } @else {
            @if (consumptionData.items().length === 0) {
                <div class="consumption-list__no-results">
                    <mat-icon class="consumption-list__no-results-icon">search_off</mat-icon>
                    {{ 'CONSUMPTION_LIST.NO_CONSUMPTIONS_FOUND' | translate }}
                </div>
            }

            <div class="consumption-list__groups">
                @for (group of groupedConsumptions(); track group.date) {
                    <div class="consumption-list__day">
                        <div class="consumption-list__day-header">
                            <span class="consumption-list__day-label">
                                {{ group.date | localizedDate:'d MMMM y' }}
                            </span>
                            <span class="consumption-list__day-line"></span>
                        </div>
                        <div class="consumption-list__grid">
                            @for (consumption of group.items; track consumption) {
                                <fd-meal-card
                                    class="consumption-card"
                                    [meal]="consumption"
                                    (open)="openConsumptionDetails(consumption)"
                                />
                            }
                        </div>
                    </div>
                }
            </div>
        }

        @if (consumptionData.totalPages > 1) {
            <fd-ui-pagination class="consumption-list__pagination"
                [length]="consumptionData.totalItems"
                [pageSize]="10"
                [pageIndex]="currentPageIndex"
                (pageIndexChange)="onPageChange($event)"
            />
        }
    </fd-page-body>
</div>
