<div class="consumption-list" #container>
    <div class="consumption-list__header">
        <h2 class="consumption-list__title">{{ 'CONSUMPTION_LIST.TITLE' | translate }}</h2>

        <div class="consumption-list__actions">
            <div class="consumption-list__search-group">
                <form [formGroup]="searchForm" class="consumption-list__date-range-form">
                    <fd-ui-date-range-input
                        formControlName="dateRange"
                        class="consumption-list__date-input"
                        [label]="'CONSUMPTION_LIST.CHOOSE_DATES' | translate"
                        [startPlaceholder]="'CONSUMPTION_LIST.DATE_PLACEHOLDER' | translate"
                        [endPlaceholder]="'CONSUMPTION_LIST.DATE_PLACEHOLDER' | translate"
                        [hideSubscript]="true"
                    ></fd-ui-date-range-input>
                </form>
            </div>
            <fd-ui-button
                class="consumption-list__add-button"
                icon="add"
                (click)="goToConsumptionAdd()"
            >
                {{ 'CONSUMPTION_LIST.ADD_CONSUMPTION_BUTTON' | translate }}
            </fd-ui-button>
        </div>
    </div>

    @if (consumptionData.isLoading()) {
        <fd-ui-loader class="consumption-list__loader"></fd-ui-loader>
    } @else {
        @if (consumptionData.items().length === 0) {
            <div class="consumption-list__no-results">
                <mat-icon class="consumption-list__no-results-icon">search_off</mat-icon>
                {{ 'CONSUMPTION_LIST.NO_CONSUMPTIONS_FOUND' | translate }}
            </div>
        }

        @for (consumption of consumptionData.items(); track consumption) {
            <fd-ui-entity-card
                class="consumption-card fd-ui-entity-card--hoverable"
                appearance="info"
                (click)="openConsumptionDetails(consumption)"
                [imageUrl]="consumption.imageUrl || undefined"
            >
                <div class="product-card consumption-card__content">
                    <div class="product-card__header">
                        <div class="product-card__title">
                            <span class="product-card__name">
                                @if (consumption.mealType) {
                                    {{ ('MEAL_TYPES.' + consumption.mealType) | translate }}
                                } @else {
                                    {{ 'CONSUMPTION_LIST.DATE' | translate }}
                                }
                            </span>
                        </div>
                        <span class="product-card__barcode">
                            {{ consumption.date | date:'dd.MM.yyyy' }} · {{ consumption.date | date:'HH:mm' }}
                        </span>
                    </div>
                    <div class="product-card__stats">
                        <span class="product-card__calories">
                            {{ 'CONSUMPTION_LIST.TOTAL_CALORIES' | translate }}:
                            {{ consumption.totalCalories | number: '1.0-2' }}
                            {{ 'PRODUCT_LIST.KCAL' | translate }}
                        </span>
                        <span class="product-card__macros">
                            {{ 'PRODUCT_LIST.PROTEINS' | translate }}: {{ consumption.totalProteins | number: '1.0-2' }}g ·
                            {{ 'PRODUCT_LIST.FATS' | translate }}: {{ consumption.totalFats | number: '1.0-2' }}g ·
                            {{ 'PRODUCT_LIST.CARBS' | translate }}: {{ consumption.totalCarbs | number: '1.0-2' }}g
                        </span>
                    </div>
                    <div class="consumption-card__meta">
                        <span class="consumption-card__count">
                            {{ 'CONSUMPTION_LIST.ITEM_COUNT' | translate }}: {{ consumption.items.length }}
                        </span>
                        @if (consumption.comment) {
                            <span class="consumption-card__comment">
                                {{ consumption.comment }}
                            </span>
                        }
                    </div>
                </div>
            </fd-ui-entity-card>
        }
    }

    @if (consumptionData.totalPages > 1) {
        <fd-ui-pagination
            class="consumption-list__pagination"
            [length]="consumptionData.totalItems"
            [pageSize]="10"
            [pageIndex]="currentPageIndex"
            (pageIndexChange)="onPageChange($event)"
        ></fd-ui-pagination>
    }
</div>
