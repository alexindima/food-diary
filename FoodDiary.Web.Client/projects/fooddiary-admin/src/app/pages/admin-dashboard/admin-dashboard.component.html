<section class="admin-dashboard">
  <header class="admin-dashboard__header">
    <div>
      <h1 class="admin-dashboard__title">Admin Dashboard</h1>
      <p class="admin-dashboard__subtitle">Quick overview of user activity.</p>
    </div>
  </header>

  <div class="admin-dashboard__metrics">
    <fd-ui-card class="admin-dashboard__metric-card" appearance="entry" title="Total users">
      <div class="admin-dashboard__metric-value">{{ summary()?.totalUsers ?? 0 }}</div>
      <div class="admin-dashboard__metric-label">All time</div>
    </fd-ui-card>
    <fd-ui-card class="admin-dashboard__metric-card" appearance="entry" title="Active users">
      <div class="admin-dashboard__metric-value">{{ summary()?.activeUsers ?? 0 }}</div>
      <div class="admin-dashboard__metric-label">Currently active</div>
    </fd-ui-card>
    <fd-ui-card class="admin-dashboard__metric-card" appearance="entry" title="Premium users">
      <div class="admin-dashboard__metric-value">{{ summary()?.premiumUsers ?? 0 }}</div>
      <div class="admin-dashboard__metric-label">Paid plans</div>
    </fd-ui-card>
    <fd-ui-card class="admin-dashboard__metric-card" appearance="entry" title="Deleted users">
      <div class="admin-dashboard__metric-value">{{ summary()?.deletedUsers ?? 0 }}</div>
      <div class="admin-dashboard__metric-label">Soft deleted</div>
    </fd-ui-card>
  </div>

  <div class="admin-dashboard__grid">
    <fd-ui-card class="admin-dashboard__panel" appearance="entry" title="Latest users">
      <div class="admin-dashboard__panel-body" *ngIf="summary()?.recentUsers?.length; else emptyState">
        <div class="admin-dashboard__user" *ngFor="let user of summary()?.recentUsers">
          <span>{{ user.email }}</span>
          <span class="admin-dashboard__meta">{{ user.createdOnUtc | date: 'short' }}</span>
        </div>
      </div>
      <ng-template #emptyState>
        <div class="admin-dashboard__panel-body">
          <p class="admin-dashboard__meta">No recent users.</p>
        </div>
      </ng-template>
    </fd-ui-card>
    <fd-ui-card class="admin-dashboard__panel" appearance="entry" title="AI usage (last 30 days)">
      <div class="admin-dashboard__panel-body" *ngIf="aiUsage(); else aiEmpty">
        <div class="admin-dashboard__usage-summary">
          <div>
            <div class="admin-dashboard__usage-value">{{ aiUsage()?.totalTokens ?? 0 }}</div>
            <div class="admin-dashboard__meta">Total tokens</div>
          </div>
          <div>
            <div class="admin-dashboard__usage-value">{{ aiUsage()?.inputTokens ?? 0 }}</div>
            <div class="admin-dashboard__meta">Input</div>
          </div>
          <div>
            <div class="admin-dashboard__usage-value">{{ aiUsage()?.outputTokens ?? 0 }}</div>
            <div class="admin-dashboard__meta">Output</div>
          </div>
        </div>

        <div class="admin-dashboard__usage-grid">
          <div>
            <div class="admin-dashboard__meta admin-dashboard__usage-title">By operation</div>
            <div class="admin-dashboard__usage-list">
              <div class="admin-dashboard__usage-row" *ngFor="let item of aiUsage()?.byOperation">
                <span>{{ item.key }}</span>
                <span class="admin-dashboard__meta">{{ item.totalTokens }}</span>
              </div>
            </div>
          </div>
          <div>
            <div class="admin-dashboard__meta admin-dashboard__usage-title">By model</div>
            <div class="admin-dashboard__usage-list">
              <div class="admin-dashboard__usage-row" *ngFor="let item of aiUsage()?.byModel">
                <span>{{ item.key }}</span>
                <span class="admin-dashboard__meta">{{ item.totalTokens }}</span>
              </div>
            </div>
          </div>
        </div>

        <div class="admin-dashboard__usage-days">
          <div class="admin-dashboard__meta admin-dashboard__usage-title">Daily totals</div>
          <div class="admin-dashboard__usage-list">
            <div class="admin-dashboard__usage-row" *ngFor="let item of aiUsage()?.byDay">
              <span>{{ item.date | date: 'MMM d' }}</span>
              <span class="admin-dashboard__meta">{{ item.totalTokens }}</span>
            </div>
          </div>
        </div>
      </div>
      <ng-template #aiEmpty>
        <div class="admin-dashboard__panel-body">
          <p class="admin-dashboard__meta">No AI usage yet.</p>
        </div>
      </ng-template>
    </fd-ui-card>
  </div>
</section>
