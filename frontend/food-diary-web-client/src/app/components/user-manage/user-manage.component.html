<div class="user-manage">
    <h2 class="user-manage__title">{{ 'USER_MANAGE.EDIT_TITLE' | translate }}</h2>
    <form class="user-manage__form" [formGroup]="userForm" (ngSubmit)="onSubmit()">
        <fd-ui-card class="user-manage__card" [title]="'USER_MANAGE.ACCOUNT_SECTION' | translate">
            <div class="user-manage__card-content user-manage__card-content--account">
                <fd-ui-input
                    formControlName="email"
                    type="email"
                    [label]="'USER_MANAGE.EMAIL' | translate"
                    [placeholder]="'USER_MANAGE.EMAIL_PLACEHOLDER' | translate"
                    floatLabel="always"
                ></fd-ui-input>
                <fd-ui-button
                    type="button"
                    fill="outline"
                    variant="primary"
                    icon="lock"
                    (click)="openChangePasswordDialog()"
                >
                    {{ 'USER_MANAGE.CHANGE_PASSWORD' | translate }}
                </fd-ui-button>
            </div>
        </fd-ui-card>

        <fd-ui-card class="user-manage__card" [title]="'USER_MANAGE.PERSONAL_SECTION' | translate">
            <div class="user-manage__card-content user-manage__card-content--personal">
                <fd-ui-input
                    formControlName="username"
                    [label]="'USER_MANAGE.USERNAME' | translate"
                    [placeholder]="'USER_MANAGE.USERNAME_PLACEHOLDER' | translate"
                    floatLabel="always"
                ></fd-ui-input>
                <fd-ui-input
                    formControlName="firstName"
                    [label]="'USER_MANAGE.FIRST_NAME' | translate"
                    [placeholder]="'USER_MANAGE.FIRST_NAME_PLACEHOLDER' | translate"
                    floatLabel="always"
                ></fd-ui-input>
                <fd-ui-input
                    formControlName="lastName"
                    [label]="'USER_MANAGE.LAST_NAME' | translate"
                    [placeholder]="'USER_MANAGE.LAST_NAME_PLACEHOLDER' | translate"
                    floatLabel="always"
                ></fd-ui-input>
                <fd-ui-date-input
                    formControlName="birthDate"
                    mode="single"
                    [label]="'USER_MANAGE.BIRTH_DATE' | translate"
                    [placeholder]="'USER_MANAGE.BIRTH_DATE_PLACEHOLDER' | translate"
                    floatLabel="always"
                ></fd-ui-date-input>
                <fd-ui-select
                    formControlName="gender"
                    [label]="'USER_MANAGE.GENDER' | translate"
                    [placeholder]="'USER_MANAGE.SELECT_GENDER' | translate"
                    [options]="genderOptions"
                    floatLabel="always"
                ></fd-ui-select>
            </div>
        </fd-ui-card>

        <fd-ui-card class="user-manage__card" [title]="'USER_MANAGE.BODY_SECTION' | translate">
            <div class="user-manage__card-content user-manage__card-content--body">
                <fd-ui-input
                    formControlName="height"
                    type="number"
                    [label]="'USER_MANAGE.HEIGHT' | translate"
                    [placeholder]="'USER_MANAGE.HEIGHT_PLACEHOLDER' | translate"
                    floatLabel="always"
                ></fd-ui-input>
                <fd-ui-select
                    formControlName="activityLevel"
                    [label]="'USER_MANAGE.ACTIVITY_LEVEL' | translate"
                    [placeholder]="'USER_MANAGE.SELECT_ACTIVITY_LEVEL' | translate"
                    [options]="activityLevelOptions"
                    floatLabel="always"
                ></fd-ui-select>
            </div>
        </fd-ui-card>

        <fd-ui-card class="user-manage__card" [title]="'USER_MANAGE.NUTRITION_SECTION' | translate">
            <div class="user-manage__card-content user-manage__card-content--nutrition">
                <fd-ui-input
                    formControlName="dailyCalorieTarget"
                    type="number"
                    [label]="'USER_MANAGE.DAILY_CALORIES' | translate"
                    [placeholder]="'USER_MANAGE.DAILY_CALORIES_PLACEHOLDER' | translate"
                    floatLabel="always"
                ></fd-ui-input>
                <fd-ui-input
                    formControlName="proteinTarget"
                    type="number"
                    [label]="'USER_MANAGE.PROTEIN_TARGET' | translate"
                    [placeholder]="'USER_MANAGE.PROTEIN_TARGET_PLACEHOLDER' | translate"
                    floatLabel="always"
                ></fd-ui-input>
                <fd-ui-input
                    formControlName="fatTarget"
                    type="number"
                    [label]="'USER_MANAGE.FAT_TARGET' | translate"
                    [placeholder]="'USER_MANAGE.FAT_TARGET_PLACEHOLDER' | translate"
                    floatLabel="always"
                ></fd-ui-input>
                <fd-ui-input
                    formControlName="carbTarget"
                    type="number"
                    [label]="'USER_MANAGE.CARB_TARGET' | translate"
                    [placeholder]="'USER_MANAGE.CARB_TARGET_PLACEHOLDER' | translate"
                    floatLabel="always"
                ></fd-ui-input>
                <fd-ui-input
                    formControlName="stepGoal"
                    type="number"
                    [label]="'USER_MANAGE.STEP_GOAL' | translate"
                    [placeholder]="'USER_MANAGE.STEP_GOAL_PLACEHOLDER' | translate"
                    floatLabel="always"
                ></fd-ui-input>
                <fd-ui-input
                    formControlName="waterGoal"
                    type="number"
                    [label]="'USER_MANAGE.WATER_GOAL' | translate"
                    [placeholder]="'USER_MANAGE.WATER_GOAL_PLACEHOLDER' | translate"
                    floatLabel="always"
                ></fd-ui-input>
            </div>
        </fd-ui-card>
        <div class="user-manage__actions">
            <fd-ui-button type="submit" icon="save">
                {{ 'USER_MANAGE.SAVE_BUTTON' | translate }}
            </fd-ui-button>
        </div>
        <div class="user-manage__danger">
            <fd-ui-button
                type="button"
                variant="danger"
                fill="outline"
                icon="delete"
                (click)="onDeleteAccount()"
            >
                {{ 'USER_MANAGE.DELETE_ACCOUNT_BUTTON' | translate }}
            </fd-ui-button>
        </div>
        <tui-error class="user-manage__error" [error]="globalError()"></tui-error>
    </form>
</div>

<ng-template #successDialog let-observer>
    <div class="user-manage__dialog">
        <p class="user-manage__dialog-title">{{ 'USER_MANAGE.UPDATE_SUCCESS' | translate }}</p>
        <div class="user-manage__dialog-actions">
            <button
                class="user-manage__dialog-button"
                tuiButton
                size="m"
                (click)="observer.completeWith(true)"
            >
                {{ 'USER_MANAGE.GO_TO_HOME_BUTTON' | translate }}
            </button>
        </div>
    </div>
</ng-template>

<ng-template #changePasswordDialog let-observer>
    <form class="user-manage__dialog" [formGroup]="changePasswordForm" (ngSubmit)="onChangePasswordSubmit(observer)">
        <p class="user-manage__dialog-title">{{ 'USER_MANAGE.CHANGE_PASSWORD' | translate }}</p>
        <div class="user-manage__dialog-fields">
            <div class="user-manage__field">
                <fd-ui-input
                    type="password"
                    formControlName="currentPassword"
                    [label]="'USER_MANAGE.CURRENT_PASSWORD' | translate"
                    [placeholder]="'USER_MANAGE.CURRENT_PASSWORD_PLACEHOLDER' | translate"
                    floatLabel="always"
                ></fd-ui-input>
                <tui-error
                    formControlName="currentPassword"
                    [error]="[] | tuiFieldError | async"
                ></tui-error>
            </div>
            <div class="user-manage__field">
                <fd-ui-input
                    type="password"
                    formControlName="newPassword"
                    [label]="'USER_MANAGE.NEW_PASSWORD' | translate"
                    [placeholder]="'USER_MANAGE.NEW_PASSWORD_PLACEHOLDER' | translate"
                    floatLabel="always"
                ></fd-ui-input>
                <tui-error
                    formControlName="newPassword"
                    [error]="[] | tuiFieldError | async"
                ></tui-error>
            </div>
            <div class="user-manage__field">
                <fd-ui-input
                    type="password"
                    formControlName="confirmPassword"
                    [label]="'USER_MANAGE.CONFIRM_NEW_PASSWORD' | translate"
                    [placeholder]="'USER_MANAGE.CONFIRM_NEW_PASSWORD_PLACEHOLDER' | translate"
                    floatLabel="always"
                ></fd-ui-input>
                <tui-error
                    formControlName="confirmPassword"
                    [error]="[] | tuiFieldError | async"
                ></tui-error>
            </div>
        </div>
        <tui-error class="user-manage__error" [error]="passwordError()"></tui-error>
        <div class="user-manage__dialog-actions user-manage__dialog-actions--inline">
            <fd-ui-button
                type="button"
                fill="outline"
                variant="primary"
                (click)="onChangePasswordCancel(observer)"
            >
                {{ 'USER_MANAGE.CHANGE_PASSWORD_CANCEL' | translate }}
            </fd-ui-button>
            <fd-ui-button
                appearance="primary"
                type="submit"
                [disabled]="isPasswordSubmitting()"
                icon="save"
            >
                {{ 'USER_MANAGE.CHANGE_PASSWORD_SAVE' | translate }}
            </fd-ui-button>
        </div>
    </form>
</ng-template>

<ng-template #passwordSuccessDialog let-observer>
    <div class="user-manage__dialog">
        <p class="user-manage__dialog-title">{{ 'USER_MANAGE.CHANGE_PASSWORD_SUCCESS' | translate }}</p>
        <div class="user-manage__dialog-actions">
            <fd-ui-button icon="check" (click)="observer.complete()">
                {{ 'USER_MANAGE.CHANGE_PASSWORD_OK' | translate }}
            </fd-ui-button>
        </div>
    </div>
</ng-template>
