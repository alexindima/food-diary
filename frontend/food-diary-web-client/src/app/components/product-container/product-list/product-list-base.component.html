<div class="product-list" #container>
    <h2 class="product-list__title">
        {{ 'PRODUCT_LIST.TITLE' | translate }}
        @if (searchForm.controls.search.value) {
            ({{ 'PRODUCT_LIST.SEARCH_TITLE' | translate }} {{ searchForm.controls.search.value }})
        }
    </h2>

    <div class="product-list__actions">
        <div class="product-list__search-group">
            <form class="product-list__search-form" [formGroup]="searchForm">
                <fd-ui-input
                    class="product-list__search-input"
                    formControlName="search"
                    prefixIcon="search"
                    [clearable]="true"
                    [placeholder]="'PRODUCT_LIST.SEARCH_PLACEHOLDER' | translate"
                    suffixButtonIcon="qr_code_scanner"
                    [suffixButtonAriaLabel]="'PRODUCT_LIST.SCAN_BARCODE' | translate"
                    (cleared)="searchForm.controls.search.setValue('')"
                    (suffixButtonClicked)="openBarcodeScanner()"
                ></fd-ui-input>
            </form>
            <fd-ui-checkbox
                class="product-list__toggle"
                [label]="'PRODUCT_LIST.ONLY_MY_PRODUCTS' | translate"
                [formControl]="searchForm.controls.onlyMine"
            ></fd-ui-checkbox>
        </div>
        <fd-ui-button
            class="product-list__add-button"
            icon="add"
            (click)="onAddProductClick()"
        >
            {{ 'PRODUCT_LIST.ADD_PRODUCT_BUTTON' | translate }}
        </fd-ui-button>
    </div>

    @if (productData.isLoading()) {
        <fd-ui-loader class="product-list__loader"></fd-ui-loader>
    } @else {
        @if (productData.items().length > 0) {
            @for (product of productData.items(); track product) {
                <fd-ui-entity-card
                    class="product-card fd-ui-entity-card--hoverable"
                    appearance="product"
                    (click)="onProductClick(product)"
                    [imageUrl]="product.imageUrl"
                >
                    <div class="product-card">
                        <div class="product-card__header">
                            <div class="product-card__title">
                                <span class="product-card__name">{{ product.name }}</span>
                                @if (product.barcode) {
                                    <span class="product-card__barcode">[{{ product.barcode }}]</span>
                                }
                            </div>
                            <div class="product-card__badges">
                                @if (product.isOwnedByCurrentUser) {
                                    <fd-badge
                                        [label]="('PRODUCT_VISIBILITY.' + product.visibility) | translate"
                                        [variant]="isPrivateVisibility(product.visibility) ? 'warning' : 'success'"
                                        [icon]="isPrivateVisibility(product.visibility) ? 'lock' : 'public'"
                                    ></fd-badge>
                                }
                                <fd-badge
                                    [label]="product.isOwnedByCurrentUser ? ('PRODUCT_BADGE.MY' | translate) : ('PRODUCT_BADGE.SHARED' | translate)"
                                    [variant]="product.isOwnedByCurrentUser ? 'primary' : 'neutral'"
                                    [icon]="product.isOwnedByCurrentUser ? 'person' : 'groups'"
                                ></fd-badge>
                            </div>
                        </div>
                        <div class="product-card__stats">
                            <span class="product-card__calories">
                                {{ 'PRODUCT_LIST.CALORIES' | translate }}: {{ product.caloriesPerBase }}
                                {{ 'PRODUCT_LIST.KCAL' | translate }}
                            </span>
                            <span class="product-card__macros">
                                {{ 'PRODUCT_LIST.PROTEINS' | translate }}: {{ product.proteinsPerBase }}g ·
                                {{ 'PRODUCT_LIST.FATS' | translate }}: {{ product.fatsPerBase }}g ·
                                {{ 'PRODUCT_LIST.CARBS' | translate }}: {{ product.carbsPerBase }}g
                            </span>
                        </div>
                        <div class="product-card__serving">
                            {{ 'PRODUCT_MANAGE.PRODUCT_TYPE' | translate }}:
                            {{ getProductTypeTranslationKey(product) | translate }}
                        </div>
                    </div>
                </fd-ui-entity-card>
            }
        } @else {
            <div class="product-list__no-results">
                <mat-icon class="product-list__no-results-icon">search_off</mat-icon>
                {{ 'PRODUCT_LIST.NO_PRODUCTS_FOUND' | translate }}
            </div>
        }
    }

    @if (productData.totalPages > 1) {
        <fd-ui-pagination
            class="product-list__pagination"
            [length]="productData.totalItems"
            [pageSize]="pageSize"
            [pageIndex]="currentPageIndex"
            (pageIndexChange)="onPageChange($event)"
        ></fd-ui-pagination>
    }
</div>
