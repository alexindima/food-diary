<div class="recipe-list" #container>
    <h2 class="recipe-list__title">
        {{ 'RECIPE_LIST.TITLE' | translate }}
        @if (searchForm.controls.search.value) {
            ({{ 'RECIPE_LIST.SEARCH_TITLE' | translate }} {{ searchForm.controls.search.value }})
        }
    </h2>

    <div class="recipe-list__actions">
        <div class="recipe-list__search-group">
            <form class="recipe-list__search-form" [formGroup]="searchForm">
                <fd-ui-input
                    class="recipe-list__search-input"
                    formControlName="search"
                    prefixIcon="search"
                    [clearable]="true"
                    [placeholder]="'RECIPE_LIST.SEARCH_PLACEHOLDER' | translate"
                    (cleared)="searchForm.controls.search.setValue('')"
                ></fd-ui-input>
            </form>
            <fd-ui-checkbox
                class="recipe-list__toggle"
                [label]="'RECIPE_LIST.ONLY_MY_RECIPES' | translate"
                [formControl]="searchForm.controls.onlyMine"
            ></fd-ui-checkbox>
        </div>

        <fd-ui-button
            class="recipe-list__add-button"
            icon="add"
            (click)="onAddRecipeClick()"
        >
            {{ 'RECIPE_LIST.ADD_RECIPE_BUTTON' | translate }}
        </fd-ui-button>
    </div>

    @if (recipeData.isLoading()) {
        <tui-loader class="recipe-list__loader"></tui-loader>
    } @else {
        @if (recipeData.items().length > 0) {
            <div class="recipe-list__items">
                @for (recipe of recipeData.items(); track recipe.id) {
                    <fd-ui-entity-card
                        class="fd-ui-entity-card--hoverable"
                        appearance="recipe"
                        (click)="onRecipeClick(recipe)"
                        [imageUrl]="recipe.imageUrl"
                    >
                        <div class="recipe-card product-card">
                            <div class="product-card__header">
                                <div class="product-card__title">
                                    <span class="product-card__name">{{ recipe.name }}</span>
                                </div>
                                <div class="product-card__badges">
                                    @if (recipe.isOwnedByCurrentUser) {
                                        <fd-badge
                                            [label]="getVisibilityTranslation(recipe.visibility)"
                                            [variant]="isPrivateVisibility(recipe.visibility) ? 'warning' : 'success'"
                                            [icon]="isPrivateVisibility(recipe.visibility) ? 'lock' : 'public'"
                                        ></fd-badge>
                                    }
                                    <fd-badge
                                        [label]="recipe.isOwnedByCurrentUser ? ('RECIPE_BADGE.MY' | translate) : ('RECIPE_BADGE.SHARED' | translate)"
                                        [variant]="recipe.isOwnedByCurrentUser ? 'primary' : 'neutral'"
                                        [icon]="recipe.isOwnedByCurrentUser ? 'person' : 'groups'"
                                    ></fd-badge>
                                </div>
                            </div>
                            <div class="product-card__stats">
                                <span class="product-card__calories">
                                    {{ 'PRODUCT_LIST.CALORIES' | translate }}: {{ recipe.totalCalories ?? '-' }}
                                    {{ 'PRODUCT_LIST.KCAL' | translate }}
                                </span>
                                <span class="product-card__macros">
                                    {{ 'PRODUCT_LIST.PROTEINS' | translate }}: {{ recipe.totalProteins ?? '-' }}g ·
                                    {{ 'PRODUCT_LIST.FATS' | translate }}: {{ recipe.totalFats ?? '-' }}g ·
                                    {{ 'PRODUCT_LIST.CARBS' | translate }}: {{ recipe.totalCarbs ?? '-' }}g
                                </span>
                            </div>
                            <div class="recipe-card__meta">
                                <span class="recipe-card__prep-time">
                                    {{ 'RECIPE_LIST.PREP_TIME' | translate }}:
                                    @if (getPrepTime(recipe) !== null) {
                                        {{ getPrepTime(recipe) }} {{ 'RECIPE_DETAIL.MIN' | translate }}
                                    } @else {
                                        -
                                    }
                                </span>
                                <span class="recipe-card__ingredients">
                                    {{ 'RECIPE_LIST.INGREDIENTS_COUNT' | translate }}: {{ getIngredientCount(recipe) }}
                                </span>
                            </div>
                        </div>
                    </fd-ui-entity-card>
                }
            </div>
        } @else {
            <div class="recipe-list__no-results">
                <tui-icon
                    class="recipe-list__no-results-icon"
                    icon="@tui.search-remove"
                ></tui-icon>
                {{ 'RECIPE_LIST.NO_RECIPES_FOUND' | translate }}
            </div>
        }
    }

    @if (recipeData.totalPages > 1) {
        <tui-pagination
            [length]="recipeData.totalPages"
            [(index)]="currentPageIndex"
            (indexChange)="onPageChange($event)"
            class="recipe-list__pagination"
        ></tui-pagination>
    }
</div>
