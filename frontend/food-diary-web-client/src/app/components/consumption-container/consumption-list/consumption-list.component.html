<div class="consumption-list" #container>
    <h2 class="consumption-list__title">{{ 'CONSUMPTION_LIST.TITLE' | translate }}</h2>

    <div class="consumption-list__actions">
        <div class="consumption-list__search-group">
            <form [formGroup]="searchForm" class="consumption-list__date-range-form">
                <fd-ui-date-input
                    formControlName="dateRange"
                    mode="range"
                    class="consumption-list__date-input"
                    [label]="'CONSUMPTION_LIST.CHOOSE_DATES' | translate"
                    [placeholder]="'CONSUMPTION_LIST.DATE_PLACEHOLDER' | translate"
                ></fd-ui-date-input>
            </form>
        </div>
        <fd-ui-button
            class="consumption-list__add-button"
            icon="add"
            (click)="goToConsumptionAdd()"
        >
            {{ 'CONSUMPTION_LIST.ADD_CONSUMPTION_BUTTON' | translate }}
        </fd-ui-button>
    </div>

    @if (consumptionData.isLoading()) {
        <tui-loader class="consumption-list__loader"></tui-loader>
    } @else {
        @if (consumptionData.items().length === 0) {
            <div class="consumption-list__no-results">
                <span class="consumption-list__no-results-icon">üîç</span>
                {{ 'CONSUMPTION_LIST.NO_CONSUMPTIONS_FOUND' | translate }}
            </div>
        }

        @for (consumption of consumptionData.items(); track consumption) {
            <div
                class="consumption-card-wrapper"
                (click)="openConsumptionDetails(consumption)"
            >
                <fd-ui-card appearance="general">
                    <div class="consumption-card">
                        <div class="consumption-card__header">
                    <span class="consumption-card__date">
                        @if (consumption.mealType) {
                            {{ ('MEAL_TYPES.' + consumption.mealType) | translate }}
                        } @else {
                            {{ 'CONSUMPTION_LIST.DATE' | translate }}
                        }
                        : {{ consumption.date | date:'dd.MM.yyyy' }} - {{ consumption.date | date:'HH:mm' }}
                    </span>
                        <span class="consumption-card__item-count">{{ 'CONSUMPTION_LIST.ITEM_COUNT' | translate }}: {{ consumption.items.length }}</span>
                    </div>
                    @if (consumption.comment) {
                        <span class="consumption-card__comment">
                        {{ consumption.comment }}
                    </span>
                    }
                    <div class="consumption-card__details">
                        <span class="consumption-card__calories">{{ 'CONSUMPTION_LIST.TOTAL_CALORIES' | translate }}: {{ consumption.totalCalories | number: '1.0-2' }} kcal</span>
                        <div class="consumption-card__macros">
                            {{ 'CONSUMPTION_LIST.TOTAL_PROTEINS' | translate }}: {{ consumption.totalProteins | number: '1.0-2' }}g |
                            {{ 'CONSUMPTION_LIST.TOTAL_FATS' | translate }}: {{ consumption.totalFats | number: '1.0-2' }}g |
                            {{ 'CONSUMPTION_LIST.TOTAL_CARBS' | translate }}: {{ consumption.totalCarbs | number: '1.0-2' }}g
                        </div>
                    </div>
                    </div>
                </fd-ui-card>
            </div>

        }
    }

    @if (consumptionData.totalPages > 1) {
        <tui-pagination
            class="consumption-list__pagination"
            [length]="consumptionData.totalPages"
            [(index)]="currentPageIndex"
            (indexChange)="onPageChange($event)">
        </tui-pagination>
    }
</div>
